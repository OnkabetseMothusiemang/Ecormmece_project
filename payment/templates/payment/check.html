{% extends 'base.html' %}


{% block content %}


 <!-- Header-->
 
    <div class="container px-4 px-lg-5 my-5">
        <div class="text-center text-black">
            <h1 class="display-4 fw-bolder">Checkout</h1>
            <p class="lead fw-normal text-black-50 mb-0">Review Your Order</p>
        </div>
    </div>


  <br>
  <div class="container">

       <div class="row">

            <div class="col-md-6 offset-md-3">
                <div class="card">
                    <div class="card-header">
                      Order Summary
                    </div>
                    <div class="card-body">

                        {% for product in cart_products %}


                           {{ product.name }}:

                              
                                 {% if product.is_sale %}

                                      R{{ product.sale_price }}

                                {% else %}

                                      R{{ product.price }}

                            
                            {% endif %}

                          
                           <small> Quantity: 
                            
                           {% for key, value in  quantities.items %}

                                {% if key == product.id|slugify %}

                                      {{ value }}   

                                {% endif %}

                            {% endfor %}
                           </small>
                           <br><br>
                    
                        {% endfor %}
                         <strong>
                            Total:   R{{ totals }}
                         </strong>
                         <br>
                         <br>
                         <a href="{% url 'cart_summary' %}" class="btn btn-sm btn-outline-secondary">Update Items</a>

                        
                       
                        
                      
                    </div>
                  </div>
            </div>

         </div>
  </div>
 <br><br>
  <div id="paypal-button-container"></div>

      


  <script src="https://www.paypal.com/sdk/js?client-id=AfZwWFJjsXsuJ2_fUxJtNVrax1IlM1mtYuoWgL8KmV9EeydVr7feObgz2-yrzoT1vgTpixZ2euSAAhcd&currency=USD"></script>
  
  <script>
      paypal.Buttons({
          createOrder: function(data, actions) {
              return (actions.order.create)({
                  purchase_units: [{
                  amount: {
                  value: '{{ totals }}'
                  }
        }]
              });
          },
          
          onApprove: function(data, actions){
        return actions.order.capture().then(function(details){
          var payerName = details.payer.name.given_name;
          if (details.payer.name.surname) {
              payerName += ' ' + details.payer.name.surname;
          }
        alert('Transaction completed by ' + payerName);
      });
    }
    }).render('#paypal-button-container');
  
  </script>
        
  
  
<br>
<br>
<br>
<br> <br>
<br>

{% endblock %}